extends layout

block content
  h1= title
  p Welcome to #{title}

  #datStuff

  //- ask server to download the text of Alice in Wonderland
  //- from project Gutenberg
  script(type='text/javascript').

    var wordToLines = {};

    var putBookOnScreen = function(text) {
      $('#datStuff').html(text);
    }

    //- split and remove empties
    var cleanSplit = function(text, splitCond) {
      return text.split(splitCond).filter(function(e){ return e !== "" });
    }

    var breakIntoWords = function(text) {
      return text.split(/\W/);
    }

    $.ajax('/alice', {
      success: function (data) {
        putBookOnScreen(data);

        var lines, i, l,
            wordsInLines = [];

        lines = cleanSplit(data, '\n');

        //- create `wordsInLines`
        //    [ ["a","b"], ["c","d","e"] ]
        for (i = 0; i < lines.length; i++) {
          l = cleanSplit(lines[i], /\W/);
          wordsInLines.push(l);
        }

        //- create `wordToLines`
        //    { "a": [1], "b": [1, 4, 12], "c": [2], ... }
        $.each(wordsInLines, function(line_no, wordsList) {
          $.each(wordsList, function(word_no, word) {
            if (wordToLines[word] === undefined) {
              wordToLines[word] = [line_no];
            } else {
              wordToLines[word].push(line_no);
            }
          })
        });
      }
    });
